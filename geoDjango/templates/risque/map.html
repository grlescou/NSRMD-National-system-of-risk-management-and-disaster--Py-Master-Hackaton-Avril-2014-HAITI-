<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
{% load staticfiles %}
<head>
    <title></title>
    <link href="{% static 'css/map.css' %}" rel="stylesheet">
    <script src="{% static 'jscript/OpenLayers-2.13.1/lib/OpenLayers.js' %}"></script>
    <script src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js" type="text/javascript"></script>
<script src="http://extjs.cachefly.net/ext-3.4.0/ext-all.js"  type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/resources/css/ext-all.css"/>
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>

   <script src="{% static 'jscript/lib/FeaturePopups.js' %}"></script>
<script src="{% static 'jscript/GeoExt/lib/GeoExt.js' %}" type="text/javascript"></script>

<script src="{% static 'jscript/jquery-chosen.js' %}" type="text/javascript"></script>

     <!-----------------------------------------------  -->

 <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/ext-all.js"></script>
        <link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/resources/css/ext-all.css" />
        <link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/examples/shared/examples.css" />
        <!-- Google Maps API for "localhost" -->
        <!--
        <script src='http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjpkAC9ePGem0lIq5XcMiuhR_wWLPFku8Ix9i2SXYRVK3e45q1BQUd_beF8dtzKET_EteAjPdGDwqpQ'></script>
        -->
        <!-- Google Maps API for "dev.geoext.org" -->

           <link rel="stylesheet" href="{% static 'jscript/OpenLayers-2.13.1/theme/default/style.css' %}" type="text/css">
            <script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
               <!-- <link rel="stylesheet" href="{% static 'jscript/OpenLayers-2.13.1/theme/default/style.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'jscript/OpenLayers-2.13.1/theme/default/google.css' %}" type="text/css"> -->

    <!---           ---------------------------------------      -->


<script type="text/javascript">
    function getRisqueSection(){
        $.getJSON('/test/jsonRisquesection/', function(jd) {
            console.log(jd.data);
        })
    }
{#    <script type='text/javascript'>#}
{#            getRisqueSection();#}
{#</script>#}
</script>
{#<script type="text/javascript">#}
{#    $(document).ready(function(){#}
{#        #}
{#    });#}
{#</script>#}
    <style type="text/css">

.toggle-modal {
	position: absolute;
	margin: 0 auto;
	z-index: 9999;
	bottom: 20px;
	right: 0;
	left: 0;
}
 .beatydialog {
    background: #222222;
     width: 300px;
     height: 200px;
     color: #ffffff;
	filter: alpha(opacity=40);
	-moz-opacity: 0.4;
	-khtml-opacity: 0.4;
	opacity: 0.4;
     margin-left: 20px;


}
.modal-dialog-left{
    margin-left: 10px;
    margin-top: 30%;

}
.scrolling{
    overflow: auto;
}

.green-black{
    width: 15px;
    height: 5px;
    background: #00FF00;
}

.green-light{
    width: 15px;
    height: 5px;
    background: #00FF99;
}

.yellow{
    width: 15px;
    height: 5px;
    background: #FFFF33;
}

.red{
    width: 15px;
    height: 5px;
    background: #FF0000;
}


</style>


    <script type="text/javascript">
{#     var map = new OpenLayers.Map('map');#}
{#     var wms = new OpenLayers.Layer.WMS(#}
{#         "OpenLayers WMS", "http://labs.metacarta.com/wms/vmap0",#}
{#         {layers: 'basic'}#}
{#     );#}
{##}
{#     var layer = new OpenLayers.Layer.Vector("GeoJSON", {#}
{#         strategies: [new OpenLayers.Strategy.Fixed()],#}
{#         protocol: new OpenLayers.Protocol.HTTP({#}
{#            url: "/test/jsonmaps/",#}
{#            format: new OpenLayers.Format.GeoJSON()#}
{#         })#}
{#     });#}
{##}
{#     map.addLayers([wms, layer]);#}
{#     console.log(layer);#}
{#     map.zoomToExtent(new OpenLayers.Bounds(#}
{#         -3.92, 44.34, 4.87, 49.55#}
{#     ));#}

  var map;
            var extent = new OpenLayers.Bounds(-5, 35, 15, 55);
            options = {
            projection: new OpenLayers.Projection("EPSG:900913"),
            units: "m",
            numZoomLevels: 18,
            maxResolution: 156543.0339,
            maxExtent: new OpenLayers.Bounds(-20037508, -20037508,
                                             20037508, 20037508.34)
        }

        optionsMap = {
            projection: new OpenLayers.Projection("EPSG:4326"),
            units: "m",
            maxResolution: 156543.0339
        }


            function init(){
               map = new OpenLayers.Map('map',optionsMap);

                var lonLat = new OpenLayers.LonLat(-72.179833000000000, 19.120622000000000);


                var zoom = 9;
                lonLat.transform(
            new OpenLayers.Projection("EPSG:4326"), options.projection
        );


                var OSM = new OpenLayers.Layer.OSM("OpenStreetMap");


    var gsat = new OpenLayers.Layer.Google(
        "Google Satellite",
        {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22}
    );
    var gphy = new OpenLayers.Layer.Google(
        "Google Physical",
        {type: google.maps.MapTypeId.TERRAIN, visibility: false}
    );
    var gmap = new OpenLayers.Layer.Google(
        "Google Streets", // the default
        {numZoomLevels: 20, visibility: false}
    );
    var ghyb = new OpenLayers.Layer.Google(
        "Google Hybrid",
        {type: google.maps.MapTypeId.HYBRID, numZoomLevels: 22, visibility: false}
    );



//-----------------------------------------------------------


//-----------------------------------------------------------

var stylemapbase = new OpenLayers.Style();

                   var rulenullbase = new OpenLayers.Rule({
                  filter: new OpenLayers.Filter.Comparison({
                      type: OpenLayers.Filter.Comparison.EQUAL_TO,
                     property: "id_0",
                      value: '99'
                  }),
                  symbolizer: {pointRadius: 10, fillColor: "#bdc3c7",
{#                               fillOpacity: 0.5, strokeColor: "black"#}
                  }
                });
                stylemapbase.addRules([rulenullbase]);






//----------------------------------------------------------




//-----------------------------------------------------------

var style = new OpenLayers.Style();

                   var rulenull = new OpenLayers.Rule({
                  filter: new OpenLayers.Filter.Comparison({
                      type: OpenLayers.Filter.Comparison.EQUAL_TO,
                     property: "niveau",
                      value: null
                  }),
                  symbolizer: {pointRadius: 10, fillColor: "gray",
                               fillOpacity: 0.5, strokeColor: "black"
                  }
                });

                var ruleLow = new OpenLayers.Rule({
                  filter: new OpenLayers.Filter.Comparison({
                      type: OpenLayers.Filter.Comparison.EQUAL_TO,
                     property: "niveau",
                      value: "Faible"
                  }),
                  symbolizer: {pointRadius: 10, fillColor: "#00FF00",
                               fillOpacity: 0.5, strokeColor: "black"
                  }
                });

                var ruleM = new OpenLayers.Rule({
                  filter: new OpenLayers.Filter.Comparison({
                      type: OpenLayers.Filter.Comparison.EQUAL_TO,
                     property: "niveau",
                      value: "Modéré"
                  }),
                  symbolizer: {pointRadius: 10, fillColor: "#FFFF33",
                               fillOpacity: 0.5, strokeColor: "black"
                  }
                });

                var rulelowHigh = new OpenLayers.Rule({
                  filter: new OpenLayers.Filter.Comparison({
                      type: OpenLayers.Filter.Comparison.EQUAL_TO,
                      property: "niveau",
                      value: "Fort"
                  }),
                  symbolizer: {pointRadius: 10, fillColor: "#FF0000",
                               fillOpacity: 0.5, strokeColor: "black"
                  }
                });

                style.addRules([rulenull,ruleLow,ruleM,rulelowHigh]);






//----------------------------------------------------------

                var StyleMapbase = new OpenLayers.StyleMap({'default': stylemapbase});

                 var layerbase = new OpenLayers.Layer.Vector("Layer departement", {
                    strategies: [new OpenLayers.Strategy.Fixed()],
                    protocol: new OpenLayers.Protocol.HTTP({

                        url: "/test/jsonmapbase/",
                        format: new OpenLayers.Format.GeoJSON(),
                        featureType: "smallworld",
                        featureNS: "test/earth"

                    }),
                    styleMap: StyleMapbase
                });







                 var StyleMap = new OpenLayers.StyleMap({'default': style});

                 var layer = new OpenLayers.Layer.Vector("Zone vulnérable", {
                    strategies: [new OpenLayers.Strategy.Fixed()],
                    protocol: new OpenLayers.Protocol.HTTP({

                        url: "/test/jsonrisques/",
                        format: new OpenLayers.Format.GeoJSON(),
                        featureType: "smallworld",
                        featureNS: "test/earth"

                    }),
                    styleMap: StyleMap
                });








                    //-----------------------map event----------------------------------------------
   var fpControl = new OpenLayers.Control.FeaturePopups();
     fpControl.addLayer(layer, {
       templates: {
           hover: "${.name_3}",
           single: "Departement : ${.name_1}<br>Commune: ${.name_2}<br>Section commune: ${.name_3}<br>Risque : ${.risque}<br>Niveau de vulnérabilité: ${.niveau} <br>Degré d'exposition: ${.degre} <br>",
           item: "<li><a href=\"#\" ${showPopup(fid)}>${.commune} (${.City_1})</a></li>"
       }
     });
     map.addControl(fpControl);
                    //-------------------------------------------------------------------

                map.addLayers([OSM, gsat,gsat, gphy, gmap, ghyb,layer,layerbase,layerVul,layerDegre,]);
                map.addControl(new OpenLayers.Control.MousePosition());

                map.zoomToExtent(new OpenLayers.Bounds(
                    -3.92, 44.34, 4.87, 49.55
                ));
                map.setCenter(lonLat, zoom);
                map.addControl(new OpenLayers.Control.LayerSwitcher());


        $('.toggle-modal').click(function(){
            $('#myModal').modal({
            show : true,
            keyboard : true,
            backdrop : false
        });
        });
        $('#myModal').modal({
            show : true,
            keyboard : true,
            backdrop : true
        });
{#        $("#myModal").draggable({#}
{#            handle: ".modal-header"#}
{#        });#}


            }
    </script>

</head>
<body onload="init()">
    <input type="button" class="btn btn-lg btn-primary toggle-modal" value="Voir control légende et option">
    <!-- Modal HTML -->
    <div id="myModal" class="modal fade" style="background: transparent">
      <div class="modal-dialog modal-dialog-left">
        <div  class="modal-content beatydialog">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: red">×</button>
            <h4 class="modal-title">Légende</h4>
          </div>
          <div class="modal-body scrolling">
              <ul>
                  <li><span class="green-black">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;Faible</li>
                  <!--<li><span class="green-light">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;#3</li>-->
                  <li><span class="yellow">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;Modéré</li>
                  <li><span class="red">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;Fort</li>
                 <!-- <li><span class="green-black">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;Legende 1</li>
                  <li><span class="green-black">&nbsp;&nbsp;&nbsp;&nbsp;</span>&emsp;Legende 1</li>-->
              </ul>
          </div>
         <!-- <div class="modal-header">
            <h4 class="modal-title">Option</h4>
          </div>
          <div class="modal-body scrolling">
              <ul>
                  <li>Option 1</li>
                  <li>Option 2</li>
                  <li>Option 3</li>
                  <li>Option 4</li>
                  <li>Option 5</li>
                  <li>Option 1</li>
                  <li>Option 2</li>
              </ul>
          </div> -->
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div  id="menu" >


    </div>
    <div id="map">

    </div>

</body>
</html>